legend.position = "bottom",
legend.text = element_text(size = 12)
)
figuren_gini_mean_median
#| label: fig-gini_etter_land
#| fig-cap: "Fordeling av Gini-koeffisienter (NUTS2) etter land, 2000–2023"
figuren_gini_etter_land <- gini %>%
filter(!is.na(Gini_weighted)) %>%
mutate(land_full = recode(country,
"BE" = "Belgia", "BG" = "Bulgaria",
"NL" = "Nederland", "NO" = "Norge")) %>%
ggplot(aes(land_full, Gini_weighted, fill = land_full)) +
geom_boxplot(outlier.alpha = 0.5) +
labs(title = "Fordeling av Gini (NUTS2) etter land",
x = "Land", y = "Gini-koeffisient") +
theme_minimal(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "none")
figuren_gini_etter_land
#| label: fig-gini_over_tid
#| fig-cap: "Utvikling i Gini per NUTS2 over tid (2000–2023), fasettert etter land"
figuren_gini_over_tid <- gini %>%
filter(!is.na(Gini_weighted)) %>%        # Fjerner rader med manglende Gini (NA)
ggplot(aes(TIME_PERIOD, Gini_weighted, group = NUTS2)) +  # Setter opp tidsserie per NUTS2-region
geom_line(alpha = 0.25) +                # Tegner tynne linjer for hver NUTS2-region (gjennomsiktighet 25%)
facet_wrap(~ country, ncol = 2,          # Lager separate paneler (fasetter) for hvert land
labeller = as_labeller(c(
BE = "Belgia",
BG = "Bulgaria",
NL = "Nederland",
NO = "Norge"))) +
labs(title = "Gini per NUTS2 over tid (fasettert etter land)",  # Tittel og aksetitler
x = "År",
y = "Gini-koeffisient") +
theme_minimal(base_size = 12) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"))    # Midtstiller og gjør tittelen fet
figuren_gini_over_tid
#| label: fig-gini_mean_median
#| fig-cap: "Gjennomsnittlig og median Gini (NUTS2) per land, 2000–2023"
figuren_gini_mean_median <- ggplot() +
# lager linjer for gjennonsmitt-verdier
geom_line(
data = gini_gjennomsnittlig,
aes(x = TIME_PERIOD, y = mean_gini, color = "Gjennomsnitt"),
linewidth = 1.1
) +
# lager linjer for median-verdier
geom_line(
data = gini_median,
aes(x = TIME_PERIOD, y = median_gini, color = "Median"),
linewidth = 1.1,
linetype = "dashed"
) +
facet_wrap(~ land_full, ncol = 2) +
scale_color_manual(
values = c("Gjennomsnitt" = "#E64B35", "Median" = "#4DBBD5")
) +
labs(
title = "Utvikling i Gini: Gjennomsnitt og median",
x = "År",
y = "Gini",
color = ""
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.text = element_text(size = 12)
)
figuren_gini_mean_median
ggplot(gini_regiondata, aes(x = land_full, y = gini)) +
geom_boxplot() +
theme_minimal()
#| label: fig-gini_mean_median
#| fig-cap: "Gjennomsnittlig og median Gini (NUTS2) per land, 2000–2023"
figuren_gini_mean_median <- ggplot() +
# lager linjer for gjennonsmitt-verdier
geom_line(
data = gini_gjennomsnittlig,
aes(x = TIME_PERIOD, y = mean_gini, color = "Gjennomsnitt"),
linewidth = 1.1
) +
# lager linjer for median-verdier
geom_line(
data = gini_median,
aes(x = TIME_PERIOD, y = median_gini, color = "Median"),
linewidth = 1.1,
linetype = "dashed"
) +
facet_wrap(~ land_full, ncol = 2) +
scale_color_manual(
values = c("Gjennomsnitt" = "red", "Median" = "cyan")
) +
labs(
title = "Utvikling i Gini: Gjennomsnitt og median",
x = "År",
y = "Gini",
color = ""
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.text = element_text(size = 12)
)
figuren_gini_mean_median
#| label: fig-gini_mean_median
#| fig-cap: "Gjennomsnittlig og median Gini (NUTS2) per land, 2000–2023"
figuren_gini_mean_median <- ggplot() +
# lager linjer for gjennonsmitt-verdier
geom_line(
data = gini_gjennomsnittlig,
aes(x = TIME_PERIOD, y = mean_gini, color = "Gjennomsnitt"),
linewidth = 1.1
) +
# lager linjer for median-verdier
geom_line(
data = gini_median,
aes(x = TIME_PERIOD, y = median_gini, color = "Median"),
linewidth = 1.1,
linetype = "dashed"
) +
facet_wrap(~ land_full, ncol = 2) +
scale_color_manual(
values = c("Gjennomsnitt" = "orange", "Median" = "cyan")
) +
labs(
title = "Utvikling i Gini: Gjennomsnitt og median",
x = "År",
y = "Gini",
color = ""
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.text = element_text(size = 12)
)
figuren_gini_mean_median
#| label: fig-gini_mean_median
#| fig-cap: "Gjennomsnittlig og median Gini (NUTS2) per land, 2000–2023"
figuren_gini_mean_median <- ggplot() +
# lager linjer for gjennonsmitt-verdier
geom_line(
data = gini_gjennomsnittlig,
aes(x = TIME_PERIOD, y = mean_gini, color = "Gjennomsnitt"),
linewidth = 1.1
) +
# lager linjer for median-verdier
geom_line(
data = gini_median,
aes(x = TIME_PERIOD, y = median_gini, color = "Median"),
linewidth = 1.1,
linetype = "dashed"
) +
facet_wrap(~ land_full, ncol = 2) +
scale_color_manual(
values = c("Gjennomsnitt" = "red", "Median" = "cyan")
) +
labs(
title = "Utvikling i Gini: Gjennomsnitt og median",
x = "År",
y = "Gini",
color = ""
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.text = element_text(size = 12)
)
figuren_gini_mean_median
# pakker
library(dineq)
library(dplyr)
library(ggplot2)
library(stringr)
library(tidyverse)
# install datapakken "eurostat"
# install.packages("eurostat")
library(eurostat)
# laster ned datasettet GDP (nama_10r_3gdp)
gdp <- get_eurostat("nama_10r_3gdp", time_format = "num")
# velger tidperiod 2000-2023, unit i MIO_EUR (Million euro), og 4 land ("BE", "NL", "BG", "NO")
gdp <- gdp %>%
filter(unit == "MIO_EUR") %>%
mutate(TIME_PERIOD = as.numeric(TIME_PERIOD), geo = as.character(geo)) %>%
filter(TIME_PERIOD >= 2000, TIME_PERIOD <= 2023) %>% #velger år 2000-2023
filter(substr(geo, 1, 2) %in% c("BE", "NL", "BG", "NO")) %>% # velger 4 land
filter(nchar(geo) == 5)    # velger NUTS3
# viser BNP-datastruktur
glimpse(gdp)
# laster ned datasettet population (demo_r_pjanaggr3)
population <- get_eurostat("demo_r_pjanaggr3", time_format = "num")
# velger tidperiod 2000-2023, age Total population (Million euro), og 4 land ("BE", "NL", "BG", "NO")
population <- population %>%
filter(sex == "T", age == "TOTAL") %>%
mutate(TIME_PERIOD = as.numeric(TIME_PERIOD), geo = as.character(geo)) %>%
filter(between(TIME_PERIOD, 2000, 2023)) %>% #velger år 2000-2023
filter(substr(geo, 1, 2) %in% c("BE", "NL", "BG", "NO")) %>% # velger 4 land
filter(nchar(geo) == 5)    # velger NUTS3
# viser population-datastruktur
glimpse(population)
# Merger datasetter GDP og papulation
gdp_pop <- left_join(
gdp,
population,
by = join_by(geo, TIME_PERIOD),
suffix = c("_gdp", "_pop"))
# Teller antall manglende verdier (NA) i hver variabel
colSums(is.na(gdp_pop))
# Viser totalt antall manglende verdier i hele datasettet
sum(is.na(gdp_pop))
# Dette steget brukes for å sjekke om datasettet har manglende verdier. De to metodene viser det samme resultatet – 2 310 manglende verdier i datasettet etter merged.
# Fjerner manglende verdier i BNP- og befolkningskolonnene før videre beregninger
gdp_pop <- gdp_pop %>%
drop_na(values_gdp, values_pop)
# Beregner BNP per innbygger etter å merge dataene
gdp_pop <- gdp_pop %>%
mutate(GDPC = (values_gdp * 1e6) / values_pop) %>% # BNP per innbygger (GDPC) er beregnet i euro per person
filter(values_pop > 0, is.finite(GDPC)) # Fjerner ugyldige eller ekstreme observasjoner
# Sjekker datastrukturen og verdiene etter sammenslåing og beregning
# Viser strukturen til datasettet etter beregningen
glimpse(gdp_pop)
# Oppsummerer sentrale statistiske mål for å kontrollere verdiene
summary(gdp_pop)
# Grunnleggende deskriptiv statistikk for merged datasettet
gdp_pop_summary <- gdp_pop %>%
filter(values_pop > 0, is.finite(GDPC)) %>%
summarise(
n_obs = n(),
Min = min(GDPC, na.rm = TRUE),
Q1  = quantile(GDPC, 0.25, na.rm = TRUE),
Median = median(GDPC, na.rm = TRUE),
Mean = mean(GDPC, na.rm = TRUE),
Q3  = quantile(GDPC, 0.75, na.rm = TRUE),
Max = max(GDPC, na.rm = TRUE),
SD  = sd(GDPC, na.rm = TRUE)
)
gdp_pop_summary
#| label: fig-bnp_per_innbygger
#| fig-cap: "Fordeling av BNP per innbygger (alle regioner)"
bnp_per_innbygger <- gdp_pop %>%
ggplot(aes(x = GDPC)) +
geom_histogram(bins = 40, fill = "steelblue", color = "white") +
labs(
title = "Fordeling av BNP per innbygger (alle regioner)",
x = "BNP per innbygger (euro per person)",
y = "Antall regioner"
)
bnp_per_innbygger
# Deskriptiv statistikk for hvert land
gdp_pop_land_summary <- gdp_pop %>%
filter(values_pop > 0, is.finite(GDPC)) %>%
mutate(country = substr(geo, 1, 2)) %>%
group_by(country) %>%
summarise(
n_obs = n(),
Min = min(GDPC, na.rm = TRUE),
Q1  = quantile(GDPC, 0.25, na.rm = TRUE),
Median = median(GDPC, na.rm = TRUE),
Mean = mean(GDPC, na.rm = TRUE),
Q3  = quantile(GDPC, 0.75, na.rm = TRUE),
Max = max(GDPC, na.rm = TRUE),
SD  = sd(GDPC, na.rm = TRUE)
)
gdp_pop_land_summary
#| label: fig-bnp_per_innbygger_land
#| fig-cap: "Sammenligning av BNP per innbygger etter land"
bnp_per_innbygger_land  <- gdp_pop %>%
mutate(
land_full = recode(substr(geo, 1, 2),
"BE" = "Belgia",
"BG" = "Bulgaria",
"NL" = "Nederland",
"NO" = "Norge")) %>%
ggplot(aes(x = land_full, y = GDPC, fill = land_full)) +
geom_boxplot() +
labs(
title = "BNP per innbygger etter land",
x = "Land",
y = "BNP per innbygger (euro)"
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "none")
bnp_per_innbygger_land
#| label: fig-bnp_over_tid_median
#| fig-cap: "Utvikling i median BNP per innbygger (2000–2023)"
bnp_over_tid_median <- gdp_pop %>%
mutate(land = substr(geo, 1, 2)) %>%
group_by(land, TIME_PERIOD) %>%
summarise(
median_BNPI = median(GDPC, na.rm = TRUE),
.groups = "drop"
) %>%
mutate(land_full = recode(land,
"BE" = "Belgia",
"BG" = "Bulgaria",
"NL" = "Nederland",
"NO" = "Norge")) %>%
ggplot(aes(x = TIME_PERIOD, y = median_BNPI, color = land_full)) +
geom_line(linewidth = 1.2) +
scale_y_continuous(limits = c(0, 70000),
labels = scales::comma) +
labs(
title = "Utvikling i median BNP per innbygger (2000–2023)",
x = "År",
y = "BNP per innbygger (euro)",
color = "Land"
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.title = element_text(face = "bold"),
legend.position = "right"
)
bnp_over_tid_median
# Beregner befolkningsvektet Gini på NUTS2-nivå (basert på GDPC for NUTS3)
gini <- gdp_pop %>%
mutate(
NUTS2   = substr(geo, 1, 4),# Henter NUTS2-kode fra NUTS3 og legger til landkode
country = substr(geo, 1, 2)
) %>%
filter(values_pop > 0, is.finite(GDPC)) %>% # Fjerner ugyldige observasjoner (befolkning ≤ 0 eller manglende)
group_by(country, NUTS2, TIME_PERIOD) %>%
summarise(
n_nuts3 = dplyr::n(),# Teller hvor mange NUTS3-regioner som inngår i hver NUTS2-gruppe
Gini_weighted = if (dplyr::n() >= 2) {
# Beregner befolkningsvektet Gini ved hjelp av funksjonen gini.wtd()
as.numeric(dineq::gini.wtd(GDPC, weights = values_pop))
} else {
NA_real_
}, # Hvis NUTS2 bare består av én NUTS3, Gini settes til NA
.groups = "drop"
)
# Sjekker struktur og summary
# Sjekker strukturen til Gini-resultatene
glimpse(gini)
# Oppsummerer Gini-fordelingen
summary(gini$Gini_weighted)
# statistikk totalt gini
gini_totalt <- gini %>%
summarise(
n_obs = sum(!is.na(Gini_weighted)),
Min   = min(Gini_weighted, na.rm = TRUE),
Q1    = quantile(Gini_weighted, 0.25, na.rm = TRUE),
Median= median(Gini_weighted, na.rm = TRUE),
Mean  = mean(Gini_weighted, na.rm = TRUE),
Q3    = quantile(Gini_weighted, 0.75, na.rm = TRUE),
Max   = max(Gini_weighted, na.rm = TRUE),
SD    = sd(Gini_weighted, na.rm = TRUE)
)
gini_totalt
# statistikk gini etter land
gini_etter_land <- gini %>%
group_by(country) %>%
summarise(
n_obs = sum(!is.na(Gini_weighted)),
Min   = min(Gini_weighted, na.rm = TRUE),
Q1    = quantile(Gini_weighted, 0.25, na.rm = TRUE),
Median= median(Gini_weighted, na.rm = TRUE),
Mean  = mean(Gini_weighted, na.rm = TRUE),
Q3    = quantile(Gini_weighted, 0.75, na.rm = TRUE),
Max   = max(Gini_weighted, na.rm = TRUE),
SD    = sd(Gini_weighted, na.rm = TRUE),
.groups = "drop"
)
gini_etter_land
# Gjennomsnittlig Gini
gini_gjennomsnittlig <- gini %>%
filter(!is.na(Gini_weighted)) %>%
group_by(country, TIME_PERIOD) %>%
summarise(mean_gini = mean(Gini_weighted), .groups = "drop") %>%
mutate(land_full = recode(country,
"BE" = "Belgia", "BG" = "Bulgaria",
"NL" = "Nederland", "NO" = "Norge"))
gini_gjennomsnittlig
# Høyeste og laveste gjennomsnittlig Gini
gini_max_min <- gini_gjennomsnittlig %>%
group_by(country) %>%
summarise(
max_gini = max(mean_gini, na.rm = TRUE),
year_max = TIME_PERIOD[which.max(mean_gini)],
min_gini = min(mean_gini, na.rm = TRUE),
year_min = TIME_PERIOD[which.min(mean_gini)])
gini_max_min
# Median Gini per land per år
gini_median <- gini %>%
filter(!is.na(Gini_weighted)) %>%
group_by(country, TIME_PERIOD) %>%
summarise(median_gini = median(Gini_weighted), .groups = "drop") %>%
mutate(land_full = recode(country,
"BE" = "Belgia", "BG" = "Bulgaria",
"NL" = "Nederland", "NO" = "Norge"))
gini_median
# Høyeste og laveste median Gini per land (med år)
gini_median_max_min <- gini_median %>%
group_by(country) %>%
summarise(
max_median_gini = max(median_gini, na.rm = TRUE),
year_max = TIME_PERIOD[which.max(median_gini)],
min_median_gini = min(median_gini, na.rm = TRUE),
year_min = TIME_PERIOD[which.min(median_gini)])
gini_median_max_min
#| label: fig-gini_mean_median
#| fig-cap: "Gjennomsnittlig og median Gini (NUTS2) per land, 2000–2023"
figuren_gini_mean_median <- ggplot() +
# lager linjer for gjennonsmitt-verdier
geom_line(
data = gini_gjennomsnittlig,
aes(x = TIME_PERIOD, y = mean_gini, color = "Gjennomsnitt"),
linewidth = 1.1
) +
# lager linjer for median-verdier
geom_line(
data = gini_median,
aes(x = TIME_PERIOD, y = median_gini, color = "Median"),
linewidth = 1.1,
linetype = "dashed"
) +
facet_wrap(~ land_full, ncol = 2) +
scale_color_manual(
values = c("Gjennomsnitt" = "red", "Median" = "cyan")
) +
labs(
title = "Utvikling i Gini: Gjennomsnitt og median",
x = "År",
y = "Gini",
color = ""
) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "bottom",
legend.text = element_text(size = 12)
)
figuren_gini_mean_median
#| label: fig-gini_etter_land
#| fig-cap: "Fordeling av Gini-koeffisienter (NUTS2) etter land, 2000–2023"
figuren_gini_etter_land <- gini %>%
filter(!is.na(Gini_weighted)) %>%
mutate(land_full = recode(country,
"BE" = "Belgia", "BG" = "Bulgaria",
"NL" = "Nederland", "NO" = "Norge")) %>%
ggplot(aes(land_full, Gini_weighted, fill = land_full)) +
geom_boxplot(outlier.alpha = 0.5) +
labs(title = "Fordeling av Gini (NUTS2) etter land",
x = "Land", y = "Gini-koeffisient") +
theme_minimal(base_size = 13) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"),
legend.position = "none")
figuren_gini_etter_land
#| label: fig-gini_over_tid
#| fig-cap: "Utvikling i Gini per NUTS2 over tid (2000–2023), fasettert etter land"
figuren_gini_over_tid <- gini %>%
filter(!is.na(Gini_weighted)) %>%        # Fjerner rader med manglende Gini (NA)
ggplot(aes(TIME_PERIOD, Gini_weighted, group = NUTS2)) +  # Setter opp tidsserie per NUTS2-region
geom_line(alpha = 0.25) +                # Tegner tynne linjer for hver NUTS2-region (gjennomsiktighet 25%)
facet_wrap(~ country, ncol = 2,          # Lager separate paneler (fasetter) for hvert land
labeller = as_labeller(c(
BE = "Belgia",
BG = "Bulgaria",
NL = "Nederland",
NO = "Norge"))) +
labs(title = "Gini per NUTS2 over tid (fasettert etter land)",  # Tittel og aksetitler
x = "År",
y = "Gini-koeffisient") +
theme_minimal(base_size = 12) +
theme(plot.title = element_text(hjust = 0.5, face = "bold"))    # Midtstiller og gjør tittelen fet
figuren_gini_over_tid
View(gdp)
View(population)
View(gdp_pop)
View(gini_gjennomsnittlig)
View(gini_median)
View(gini)
#| label: export_each_excel
#| echo: true
#| message: false
#| warning: false
# 安装并载入 openxlsx 包（若未安装）
# install.packages("openxlsx")
library(openxlsx)
# 创建一个包含所有数据框的列表
data_list <- list(
gdp = gdp,
population = population,
gdp_pop = gdp_pop,
gini_gjennomsnittlig = gini_gjennomsnittlig,
gini_median = gini_median,
gini = gini
)
# 使用循环导出为单独的 Excel 文件
for (name in names(data_list)) {
file_name <- paste0(name, ".xlsx")
write.xlsx(data_list[[name]], file = file_name)
cat("✅ Lagret:", file_name, "\n")
}
# 将六个数据框导出为一个 Excel 文件
write.xlsx(
list(
gdp = gdp,
population = population,
gdp_pop = gdp_pop,
gini_gjennomsnittlig = gini_gjennomsnittlig,
gini_median = gini_median,
gini = gini
),
file = "msb104_alle_datasets.xlsx"
)
