---
title: "Assignment 1: Data and Descriptive, MSB104 2025"
author: Karin Liang
format: html
lang: NO_nb
editor: visual
bibliography: references.bib
---

# Introduksjon
Denne oppgaven studerer regionale økonomiske forskjeller i Belgia (BE), Nederland (NL), Bulgaria (BG) og Norge (NO). Ved å bruke Eurostat-data om BNP og befolkning beregnes BNP per innbygger for å sammenligne regioner på tvers av land og over tid.

# Del A: Subnasjonalt BNP og BNP per innbygger
Denne analysen bruker to regionale datasett fra Eurostat: GDP (nama_10r_3gdp) og papulation (demo_r_pjanaggr3).

## Datainnsamling
```{r}
# pakker
library(dineq)
library(dplyr)
library(ggplot2)
library(stringr)
library(tidyverse)

# install datapakken "eurostat"
# install.packages("eurostat")
library(eurostat)
```

### Laster ned datasettet GDP
```{r}
# laster ned datasettet GDP (nama_10r_3gdp)
gdp <- get_eurostat("nama_10r_3gdp", time_format = "num")

# velger tidperiod 2000-2023, unit i MIO_EUR (Million euro), og 4 land ("BE", "NL", "BG", "NO")
gdp <- gdp %>%
  filter(unit == "MIO_EUR") %>%
  mutate(TIME_PERIOD = as.numeric(TIME_PERIOD), geo = as.character(geo)) %>%
  filter(TIME_PERIOD >= 2000, TIME_PERIOD <= 2023) %>% #velger år 2000-2023
  filter(substr(geo, 1, 2) %in% c("BE", "NL", "BG", "NO")) %>% # velger 4 land
  filter(nchar(geo) == 5)    # velger NUTS3

# viser BNP-datastruktur
glimpse(gdp)
```
Datasettet GDP (nama_10r_3gdp) er hentet fra Eurostat og inneholder årlige verdier for BNP (bruttonasjonalprodukt) på NUTS3-nivå. Etter filtrering ifølge oppgaven består datasettet GDP av 2 591 observasjoner og 5 variabler: freq: viser frekvensen, her årlig "A" unit: måleenhet, "MIO_EUR" betyr millioner euro geo: geografisk kode "NUTS3" TIME_PERIOD: år, fra 2000 til 2023 values: BNP-verdi i millioner euro Datasettet dekker regionale BNP-data for BE (Belgia), NL (Nederland), BG (Bulgaria), NO (Norge).

### Laster ned datasettet population
```{r}
# laster ned datasettet population (demo_r_pjanaggr3)
population <- get_eurostat("demo_r_pjanaggr3", time_format = "num")

# velger tidperiod 2000-2023, age Total population (Million euro), og 4 land ("BE", "NL", "BG", "NO")
population <- population %>%
  filter(sex == "T", age == "TOTAL") %>%
  mutate(TIME_PERIOD = as.numeric(TIME_PERIOD), geo = as.character(geo)) %>%
  filter(between(TIME_PERIOD, 2000, 2023)) %>% #velger år 2000-2023
  filter(substr(geo, 1, 2) %in% c("BE", "NL", "BG", "NO")) %>% # velger 4 land
  filter(nchar(geo) == 5)    # velger NUTS3

# viser population-datastruktur
glimpse(population)
```
Datasettet papulation (demo_r_pjanaggr3) er hentet fra Eurostat og viser befolkningen per 1. januar for hver NUTS3-region. Etter filtrering ifølge oppgaven består datasettet av 3 023 observasjoner og 7 variabler: unit: måleenhet, "NR" betyr antall personer sex: kjønn, her "T" for total befolkning age: "TOTAL", viser total befolkning uten aldersinndeling values: antall personer i regionen freq, geo og TIME_PERIOD har samme betydning som i GDP datasettet Datasettet dekker den totale befolkningen i BE (Belgia), NL (Nederland), BG (Bulgaria), NO (Norge).

### Informasjon om dataene:
Begge datasettene er hentet fra Eurostat. Informasjonen om variablene bygger på metadata fra regionale økonomiske regnskaper etter NUTS 3-regioner (@Eurostat_reg_eco10_2025) og befolkning per 1. januar etter aldersgruppe, kjønn og NUTS 3-region (@Eurostat_demo_pop_2025).
BNP-datasettet (nama_10r_3gdp) [@Eurostat_reg_eco10_2025] er en del av Regional Economic Accounts og viser verdien av bruttonasjonalprodukt for de relevante europeiske regionene. Tallene er målt i millioner euro (MIO_EUR), rapporteres årlig (freq = "A") på NUTS3-nivå, og dekker perioden 2000–2023. Datasettet inneholder fem variabler: freq, unit, geo, TIME_PERIOD og values. Variablen geo representerer regionkoder, TIME_PERIOD viser år, og values gir BNP-verdi i millioner euro. Dataene rapporteres av nasjonale statistiske institutter og samles inn og standardiseres i Eurostat.
Papulation (demo_r_pjanaggr3) [@Eurostat_demo_pop_2025] kommer fra Eurostats Demography Database og viser befolkningen per 1. januar hvert år. Tallene måles i antall personer (NR) og er tilgjengelige etter kjønn og alder, men her brukes bare total befolkning (kjønn = "T", alder = "TOTAL"). Datasettet inneholder variablene freq, unit, sex, age, geo, TIME_PERIOD og values, der values viser antall personer i hver region og år.
Begge datasettene oppdateres årlig, dekker europeiske land, og gir et felles grunnlag for å beregne BNP per innbygger og analysere regionale forskjeller i Belgia (BE), Nederland (NL), Bulgaria (BG) og Norge (NO).

## Beregning av BNP per innbygger (GDPC)
### Merger datasetter GDP og papulation, og fjerner manglende verdier
```{r}
# Merger datasetter GDP og papulation
gdp_pop <- left_join(
  gdp,
  population,
  by = join_by(geo, TIME_PERIOD),
  suffix = c("_gdp", "_pop"))

# Teller antall manglende verdier (NA) i hver variabel
colSums(is.na(gdp_pop))
# Viser totalt antall manglende verdier i hele datasettet
sum(is.na(gdp_pop))
# Dette steget brukes for å sjekke om datasettet har manglende verdier. De to metodene viser det samme resultatet – 2 310 manglende verdier i datasettet etter merged.

# Fjerner manglende verdier i BNP- og befolkningskolonnene før videre beregninger
gdp_pop <- gdp_pop %>%
  drop_na(values_gdp, values_pop) 
```
Samslåing av datasett ble utført her, ifølge regionale økonomiske regnskaper etter NUTS 3-regioner og befolkning per 1. januar etter aldersgruppe, kjønn og NUTS 3-region. Datasettet BNP og population ble slått sammen ved hjelp av regionkode (geo) og år (TIME_PERIOD). Så sjekker og fjerner 2 310 manglende verdier i BNP- og befolkningskolonnene før videre beregninger.

### Beregner BNP per innbygger (GDPC) etter å merge dataene
```{r}
# Beregner BNP per innbygger etter å merge dataene
gdp_pop <- gdp_pop %>%
  mutate(GDPC = (values_gdp * 1e6) / values_pop) %>% # BNP per innbygger (GDPC) er beregnet i euro per person
  filter(values_pop > 0, is.finite(GDPC)) # Fjerner ugyldige eller ekstreme observasjoner

# Sjekker datastrukturen og verdiene etter sammenslåing og beregning
# Viser strukturen til datasettet etter beregningen
glimpse(gdp_pop)
# Oppsummerer sentrale statistiske mål for å kontrollere verdiene
summary(gdp_pop)
```
BNP per innbygger (GDPC) ble beregnet som total BNP delt på befolkningstall. Videre ble observasjoner med null eller ugyldige verdier ekskludert for å sikre et rent og pålitelig datasett før videre analyse.
glimpse(gdp_pop) viser at datasettet inneholder 2 119 observasjoner og 11 variabler etter sammenslåing og rensing. Variablene inkluderer blant annet regionkode (geo), år (TIME_PERIOD), BNP i millioner euro (values_gdp), befolkning (values_pop) og beregnet BNP per innbygger (GDPC). summary(gdp_pop) gir et overblikk over fordelingen i dataene. Tidsperioden dekker årene 2000–2023. BNP-verdiene varierer fra om lag 168 til 103 285 millioner euro, mens befolkningen i regionene varierer fra under 42 000 til over 1,29 millioner personer. Variabelen GDPC viser de beregnede verdiene for BNP per innbygger, som danner grunnlaget for den videre analysen.

## Beskrivende analyse
### Grunnleggende deskriptiv statistikk
```{r}
# Grunnleggende deskriptiv statistikk for merged datasettet
gdp_pop_summary <- gdp_pop %>%
  filter(values_pop > 0, is.finite(GDPC)) %>% 
  summarise(
    n_obs = n(),
    Min = min(GDPC, na.rm = TRUE),
    Q1  = quantile(GDPC, 0.25, na.rm = TRUE),
    Median = median(GDPC, na.rm = TRUE),
    Mean = mean(GDPC, na.rm = TRUE),
    Q3  = quantile(GDPC, 0.75, na.rm = TRUE),
    Max = max(GDPC, na.rm = TRUE),
    SD  = sd(GDPC, na.rm = TRUE)
  )
gdp_pop_summary

# viser den generelle fordelingen av BNP per innbygger
#| label: fig-bnp_per_innbygger
#| fig-cap: "Fordeling av BNP per innbygger (alle regioner). Histogrammet viser fordelingen av BNP per innbygger på tvers av alle NUTS3-regioner i Belgia, Bulgaria, Nederland og Norge for perioden 2000–2023."
bnp_per_innbygger <- gdp_pop %>% 
  ggplot(aes(x = GDPC)) +
  geom_histogram(bins = 40, fill = "steelblue", color = "white") +
  labs(
    title = "Fordeling av BNP per innbygger (alle regioner)",
    x = "BNP per innbygger (euro per person)",
    y = "Antall regioner"
  )
bnp_per_innbygger
```
Resultatene for grunnleggende deskriptiv statistikk for merged datasettet gdp_pop viser følgende nøkkeltall:
Antall observasjoner: 2 119 regioner
Minimumsverdi: 1 087 euro per person
Første kvartil (Q1): 6 061 euro
Median: 25 632 euro
Gjennomsnitt (Mean): 24 551 euro
Tredje kvartil (Q3): 35 051 euro
Maksimumsverdi: 105 721 euro
Standardavvik: 17 452 euro
@fig-bnp_per_innbygger viser at halvparten av regionene har et BNP per innbygger mellom omtrent 5 000 og 40 000 euro, og at spredningen er ganske stor. Gjennomsnittet ligger litt lavere enn medianen, noe som tyder på at fordelingen er høyreskjev, slik figuren viser. Det betyr at de fleste regionene har relativt lavt BNP per innbygger, mens noen få regioner har svært høy verdiskaping.

### Deskriptiv statistikk for hvert land
```{r}
# Deskriptiv statistikk for hvert land
gdp_pop_land_summary <- gdp_pop %>%
  filter(values_pop > 0, is.finite(GDPC)) %>% 
  mutate(country = substr(geo, 1, 2)) %>%
  group_by(country) %>%
  summarise(
    n_obs = n(),
    Min = min(GDPC, na.rm = TRUE),
    Q1  = quantile(GDPC, 0.25, na.rm = TRUE),
    Median = median(GDPC, na.rm = TRUE),
    Mean = mean(GDPC, na.rm = TRUE),
    Q3  = quantile(GDPC, 0.75, na.rm = TRUE),
    Max = max(GDPC, na.rm = TRUE),
    SD  = sd(GDPC, na.rm = TRUE)
  )
gdp_pop_land_summary

# Sammenligning mellom land
#| label: fig-bnp_per_innbygger_land
#| fig-cap: "Sammenligning av BNP per innbygger etter land. Figuren viser fordelingen av BNP per innbygger (GDPC) på NUTS3-nivå i Belgia, Bulgaria, Nederland og Norge i perioden 2000–2023. Hvert boksplott representerer variasjonen mellom regionene i hvert land."
bnp_per_innbygger_land  <- gdp_pop %>% 
  mutate(
    land_full = recode(substr(geo, 1, 2),
                       "BE" = "Belgia",
                       "BG" = "Bulgaria",
                       "NL" = "Nederland",
                       "NO" = "Norge")) %>%
  ggplot(aes(x = land_full, y = GDPC, fill = land_full)) +
  geom_boxplot() +
  labs(
    title = "BNP per innbygger etter land",
    x = "Land",
    y = "BNP per innbygger (euro)"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.position = "none")
bnp_per_innbygger_land
```
Tabellen viser beskrivende statistikk for BNP per innbygger (i euro) i de fire landene Belgia (BE), Bulgaria (BG), Nederland (NL) og Norge (NO). Resultatene viser store forskjeller mellom landene.
Belgia har en moderat inntektsfordeling, der medianen ligger på rundt 28 000 euro per person.
Bulgaria har den laveste verdien blant de fire landene. Medianen er kun 3 763 euro, og både gjennomsnitt og maksimum er langt lavere enn i de andre landene.
Nederland ligger betydelig høyere, med en median på omtrent 33 600 euro og et maksimum over 100 000 euro.
Norge har de høyeste verdiene, med en median på 53 500 euro og et gjennomsnitt på 58 300 euro. 

@fig-bnp_per_innbygger_land gir et tydelig visuelt bilde av forskjellene mellom landene.
Bulgaria skiller seg ut med svært lave verdier og liten variasjon mellom regionene, noe som indikerer et generelt lavt, men jevnt inntektsnivå.
Belgia har et bredere spenn, med enkelte regioner som ligger betydelig over medianen, men ingen ekstreme avvik.
Nederland viser både høyere nivåer og større spredning, spesielt enkelte rike regioner med høy BNP per innbygger.
Norge har høyest median og et bredt spenn, med flere regioner som ligger over 100 000 euro per person.
Diagrammet bekrefter dermed et klart nord–sør-mønster i Europa: Norge og Nederland ligger høyest i økonomisk velstand, Belgia i midten, og Bulgaria betydelig lavere.

### BNP per innbygger etter land over tid
```{r}
# Utvikling av BNP per innbygger over tid (medianverdi)
#| label: fig-bnp_over_tid_median
#| fig-cap: "Utvikling i median BNP per innbygger (2000–2023). Figuren viser hvordan median BNP per innbygger (GDPC) har utviklet seg over tid på NUTS3-nivå for Belgia, Bulgaria, Nederland og Norge. Linjene representerer landenes økonomiske utvikling målt i euro per person."
bnp_over_tid_median <- gdp_pop %>%
  mutate(land = substr(geo, 1, 2)) %>%
  group_by(land, TIME_PERIOD) %>%
  summarise(
    median_BNPI = median(GDPC, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(land_full = recode(land,
                            "BE" = "Belgia",
                            "BG" = "Bulgaria",
                            "NL" = "Nederland",
                            "NO" = "Norge")) %>%
  ggplot(aes(x = TIME_PERIOD, y = median_BNPI, color = land_full)) +
  geom_line(linewidth = 1.2) +
  scale_y_continuous(limits = c(0, 70000),
                     labels = scales::comma) +
  labs(
    title = "Utvikling i median BNP per innbygger (2000–2023)",
    x = "År",
    y = "BNP per innbygger (euro)",
    color = "Land"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    legend.title = element_text(face = "bold"),
    legend.position = "right"
  )
bnp_over_tid_median
```
@fig-bnp_over_tid_median er basert på median BNP per innbygger, og viser tydelig forskjeller i økonomisk utvikling mellom de fire landene:
Norge ligger høyest gjennom hele perioden, med median BNP per innbygger mellom 40 000 og 60 000 euro. Nederland følger som nummer to, med jevn vekst fra rundt 20 000 til over 45 000 euro. Belgia ligger noe lavere, men viser også en stabil, gradvis økning. Bulgaria starter svært lavt, under 2 000 euro i 2000, men har hatt den mest markerte veksten i prosent, opp mot 10 000 euro i 2023.
Median BNP i Norge har høyest nivå og størst variasjon, etterfulgt av Nederland, mens Belgia ligger midt i gruppen og Bulgaria betydelig lavere. Utviklingen over tid viser likevel positiv vekst i alle land.  
Sammenligningen mellom Belgia, Bulgaria, Nederland og Norge viser et klart nord–sør-mønster. Jo lenger nord det geografiske området er, desto høyere er inntekten per innbygger.
Denne utviklingen viser at selv om nivåforskjellene mellom landene fortsatt er store, har alle opplevd en jevn økonomisk vekst over tid.

# Del B: Regional ulikhet
## Litteraturgjennomgang
Ifølge artikkelen 'Regional inequality, convergence, and its determinants– A view from outer space' @Lessmann2017regional finnes det en tydelig sammenheng mellom økonomisk utvikling og forskjeller mellom regioner.  
I artikkelen @Lessmann2017regional bruker satellittbaserte nattlysdata for å måle økonomisk aktivitet i 180 land og 3166 regioner i perioden 1992–2012. Metoden gjør det mulig å analysere regionale ulikheter også i land der det mangler pålitelige inntektsdata.
Resultatene til @Lessmann2017regional viser at 67–70 prosent av landene har opplevd sigma-konvergens, det vil si at inntektsforskjellene mellom regioner har blitt mindre over tid.
Samtidig finner @Lessmann2017regional at forholdet mellom økonomisk utvikling og ulikhet følger et N-formet mønster, der ulikheten øker i lavinntektsland, reduseres i mellominntektsland og stiger svakt igjen i høyinntektsland.
Videre viser @Lessmann2017regional at naturressurser, handelsåpenhet, transportkostnader, bistand og etnisk ulikhet ofte bidrar til større regionale forskjeller. Derimot kan utdanning, føderale strukturer og høy andel dyrkbar jord bidra til å redusere dem. 
Studien til @Lessmann2017regional konkluderer med at økonomisk vekst ikke automatisk fører til utjevning mellom regioner, siden effekten avhenger av institusjoner, ressursfordeling og befolkningens utdanningsnivå. 
@Lessmann2017regional understreker også at regionale forskjeller kan ha sosiale og politiske konsekvenser, fordi økonomisk aktivitet ofte er sterkt konsentrert i enkelte byområder og ressursrike regioner. Dermed gir studien et globalt rammeverk for å forstå hvorfor enkelte land opplever regional konvergens mens andre får økende ulikhet, og hvordan geografiske, økonomiske og institusjonelle forhold påvirker utviklingsmønsteret.

## Beregning av Gini-koeffisienten på NUTS2-nivå
```{r}
# Beregner befolkningsvektet Gini på NUTS2-nivå (basert på GDPC for NUTS3)
gini <- gdp_pop %>%
  mutate(
    NUTS2   = substr(geo, 1, 4),# Henter NUTS2-kode fra NUTS3 og legger til landkode
    country = substr(geo, 1, 2)
  ) %>%
  filter(values_pop > 0, is.finite(GDPC)) %>% # Fjerner ugyldige observasjoner (befolkning ≤ 0 eller manglende
  group_by(country, NUTS2, TIME_PERIOD) %>%
  summarise(
    n_nuts3 = dplyr::n(),# Teller hvor mange NUTS3-regioner som inngår i hver NUTS2-gruppe
    Gini_weighted = if (dplyr::n() >= 2) {
      # Beregner befolkningsvektet Gini ved hjelp av funksjonen gini.wtd()
      as.numeric(dineq::gini.wtd(GDPC, weights = values_pop))
    } else {
      NA_real_ 
    }, # Hvis NUTS2 bare består av én NUTS3 → ingen intern ulikhet → Gini settes til NA
    .groups = "drop"
  ) 

# Sjekker struktur og summary
# Sjekker strukturen til Gini-resultatene
glimpse(gini)

# Oppsummerer Gini-fordelingen
summary(gini$Gini_weighted)
```
I denne delen beregnet jeg den befolkningsvektede Gini-koeffisienten på NUTS2-nivå basert på BNP per innbygger (GDPC) for NUTS3-regionene.
Jeg hentet NUTS2- og landskoder fra NUTS3-koden og fjernet ugyldige observasjoner der befolkningen var ≤ 0 eller verdiene ikke var endelige.
Deretter grupperte jeg dataene etter land, NUTS2 og år (TIME_PERIOD), og brukte funksjonen gini.wtd(GDPC, weights = values_pop) fra pakken dineq til å beregne Gini-koeffisienten med befolkningsvekter.
Beregningen bygger på flere antakelser og forenklinger:
Det antas at NUTS3-regionene gir et representativt bilde av den økonomiske aktiviteten innenfor hver NUTS2-region, og at ulikheten mellom disse kan tolkes som intern regional ulikhet.
Videre antas det at befolkningen er en egnet vekt, slik at regioner med flere innbyggere får større innflytelse på den samlede ulikheten.
Observasjoner med ugyldige eller manglende verdier er fjernet, og for NUTS2-regioner som kun består av én NUTS3-region, ble Gini satt til NA, siden intern ulikhet ikke kan defineres i slike tilfeller.
Resultatet er en tidsserie med Gini-verdier for hver NUTS2-region i perioden 2000–2023, som danner grunnlaget for videre analyse av utviklingen i regional økonomisk ulikhet.

glimpse(gini) viser at datasettet med Gini-resultater inneholder fem variabler: land (country), regionkode (NUTS2), år (TIME_PERIOD), antall NUTS3-regioner (n_nuts3) og den beregnede Gini-koeffisienten (Gini_weighted).
summary(gini$Gini_weighted) viser at Gini-verdiene varierer mellom omtrent 0.001 og 0.28, med et gjennomsnitt på rundt 0.08, og 173 NA-verdier som skyldes NUTS2-regioner med bare én NUTS3.
Dette bekrefter at beregningen fungerer som forventet, og at resultatene ligger innenfor et realistisk område for regional ulikhet.

## Datapresentasjon
### Deskriptiv statistikk (totalt og etter land)
```{r}
# statistikk totalt gini
gini_totalt <- gini %>%
  summarise(
    n_obs = sum(!is.na(Gini_weighted)),
    Min   = min(Gini_weighted, na.rm = TRUE),
    Q1    = quantile(Gini_weighted, 0.25, na.rm = TRUE),
    Median= median(Gini_weighted, na.rm = TRUE),
    Mean  = mean(Gini_weighted, na.rm = TRUE),
    Q3    = quantile(Gini_weighted, 0.75, na.rm = TRUE),
    Max   = max(Gini_weighted, na.rm = TRUE),
    SD    = sd(Gini_weighted, na.rm = TRUE)
  )
gini_totalt

# statistikk gini etter land
gini_etter_land <- gini %>%
  group_by(country) %>%
  summarise(
    n_obs = sum(!is.na(Gini_weighted)),
    Min   = min(Gini_weighted, na.rm = TRUE),
    Q1    = quantile(Gini_weighted, 0.25, na.rm = TRUE),
    Median= median(Gini_weighted, na.rm = TRUE),
    Mean  = mean(Gini_weighted, na.rm = TRUE),
    Q3    = quantile(Gini_weighted, 0.75, na.rm = TRUE),
    Max   = max(Gini_weighted, na.rm = TRUE),
    SD    = sd(Gini_weighted, na.rm = TRUE),
    .groups = "drop"
  )
gini_etter_land
```





### Visualisering
#### Figuren for gjennomsnittlig Gini per land per år
```{r}
# Gjennomsnittlig Gini per land per år
gini_gjennomsnittlig <- gini %>%
  filter(!is.na(Gini_weighted)) %>%
  group_by(country, TIME_PERIOD) %>%
  summarise(mean_gini = mean(Gini_weighted), .groups = "drop") %>%
  mutate(land_full = recode(country,
                            "BE" = "Belgia", "BG" = "Bulgaria",
                            "NL" = "Nederland", "NO" = "Norge"))
gini_gjennomsnittlig

# Høyeste og laveste gjennomsnittlig Gini per land
gini_max_min <- gini_gjennomsnittlig %>%
  group_by(country) %>%
  summarise(
    max_gini = max(mean_gini, na.rm = TRUE),
    year_max = TIME_PERIOD[which.max(mean_gini)],
    min_gini = min(mean_gini, na.rm = TRUE),
    year_min = TIME_PERIOD[which.min(mean_gini)])
gini_max_min

# figuren for gjennomsnittlig Gini per land per år
#| label: fig-gini_gjennomsnittlig
#| fig-cap: "Utvikling i gjennomsnittlig Gini (NUTS2) etter land, 2000–2023. Figuren viser utviklingen i gjennomsnittlig befolkningsvektet Gini-koeffisient for Belgia, Bulgaria, Nederland og Norge. En lavere Gini indikerer mindre regional ulikhet mellom NUTS3-regionene innenfor hvert land."
figuren_gini_gjennomsnittlig <- gini_gjennomsnittlig %>%
  ggplot(aes(TIME_PERIOD, mean_gini, color = land_full)) +
  geom_line(linewidth = 1.2) +
  labs(title = "Utvikling i gjennomsnittlig Gini (NUTS2)",
       x = "År", y = "Gjennomsnittlig Gini", color = "Land") +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
figuren_gini_gjennomsnittlig
```


#### Figuren for median Gini per land per år
```{r}
# Median Gini per land per år
gini_median <- gini %>%
  filter(!is.na(Gini_weighted)) %>%
  group_by(country, TIME_PERIOD) %>%
  summarise(median_gini = median(Gini_weighted), .groups = "drop") %>%
  mutate(land_full = recode(country,
                            "BE" = "Belgia", "BG" = "Bulgaria",
                            "NL" = "Nederland", "NO" = "Norge"))
gini_median

# Høyeste og laveste median Gini per land (med år)
gini_median_max_min <- gini_median %>%
  group_by(country) %>%
  summarise(
    max_median_gini = max(median_gini, na.rm = TRUE),
    year_max = TIME_PERIOD[which.max(median_gini)],
    min_median_gini = min(median_gini, na.rm = TRUE),
    year_min = TIME_PERIOD[which.min(median_gini)])
gini_median_max_min

# figuren for median Gini per land per år
#| label: fig-gini_median
#| fig-cap: "Utvikling i median Gini (NUTS2) etter land, 2000–2023. Figuren viser endringen i medianverdien av den befolkningsvektede Gini-koeffisienten for Belgia, Bulgaria, Nederland og Norge. Median Gini gir et robust mål på regional ulikhet og reduserer påvirkningen av ekstreme verdier."
figuren_gini_median <- gini_median %>% 
  ggplot(aes(TIME_PERIOD, median_gini, color = land_full)) +
  geom_line(linewidth = 1.2, linetype = "solid") +
  labs(title = "Utvikling i median Gini (NUTS2)",
       x = "År", y = "Median Gini", color = "Land") +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
figuren_gini_median

```


#### Figuren for fordeling av Gini (NUTS2) etter land
```{r}
#| label: fig-gini_etter_land
#| fig-cap: "Fordeling av Gini-koeffisienter (NUTS2) etter land, 2000–2023. Figuren viser fordelingen av befolkningsvektet Gini mellom regioner i Belgia, Bulgaria, Nederland og Norge. Hver boks representerer variasjonen i regional ulikhet på NUTS2-nivå, der høyere verdier indikerer større forskjeller mellom regionene."
figuren_gini_etter_land <- gini %>%
  filter(!is.na(Gini_weighted)) %>%
  mutate(land_full = recode(country,
                            "BE" = "Belgia", "BG" = "Bulgaria",
                            "NL" = "Nederland", "NO" = "Norge")) %>% 
  ggplot(aes(land_full, Gini_weighted, fill = land_full)) +
  geom_boxplot(outlier.alpha = 0.5) +
  labs(title = "Fordeling av Gini (NUTS2) etter land",
       x = "Land", y = "Gini-koeffisient") +
  theme_minimal(base_size = 13) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        legend.position = "none")
figuren_gini_etter_land
```

#### Figuren for Gini per NUTS2 over tid (fasettert etter land)"
```{r}
#| label: fig-gini_over_tid
#| fig-cap: "Utvikling i Gini per NUTS2 over tid (2000–2023), fasettert etter land. Figuren viser utviklingen i den befolkningsvektede Gini-koeffisienten for hver NUTS2-region i Belgia, Bulgaria, Nederland og Norge. Hver linje representerer en enkelt NUTS2-region, og fasettene viser hvordan den regionale ulikheten utvikler seg innenfor hvert land over tid."
figuren_gini_over_tid <- gini %>%
  filter(!is.na(Gini_weighted)) %>%        # Fjerner rader med manglende Gini (NA)
  ggplot(aes(TIME_PERIOD, Gini_weighted, group = NUTS2)) +  # Setter opp tidsserie per NUTS2-region
  geom_line(alpha = 0.25) +                # Tegner tynne linjer for hver NUTS2-region (gjennomsiktighet 25%)
  facet_wrap(~ country, ncol = 2,          # Lager separate paneler (fasetter) for hvert land
             labeller = as_labeller(c(
               BE = "Belgia",
               BG = "Bulgaria",
               NL = "Nederland",
               NO = "Norge"))) +
  labs(title = "Gini per NUTS2 over tid (fasettert etter land)",  # Tittel og aksetitler
       x = "År",
       y = "Gini-koeffisient") +
  theme_minimal(base_size = 12) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))    # Midtstiller og gjør tittelen fet
figuren_gini_over_tid
```





## Diskusjon









# Del C:Dokumenter bruken min av AI


